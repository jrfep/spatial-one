{
  "hash": "1df96b497cc3c681b21d42919ad2c022",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Vanishing tropical glaciers\"\nauthor: \"José R. Ferrer-Paris\"\ndate: \"2024-06-04\"\ncategories: [R code, leaflet, mapbox, Venezuela, Glaciers]\ndraft: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: dplyr\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nrequire(units)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: units\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nudunits database from /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/library/units/share/udunits/udunits2.xml\n```\n\n\n:::\n\n```{.r .cell-code}\nrequire(leaflet)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: leaflet\n```\n\n\n:::\n\n```{.r .cell-code}\nrequire(DT)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: DT\n```\n\n\n:::\n\n```{.r .cell-code}\nrequire(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: sf\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE\n```\n\n\n:::\n\n```{.r .cell-code}\noptions(dplyr.summarise.inform = FALSE)\n```\n:::\n\n\n# Where to find tropical glaciers?\n\nhttps://docs.mapbox.com/api/maps/styles/\n\n::: {.cell}\n\n```{.r .cell-code}\n#bf <- read_sf(\"assets/aux/MFT1.2_buffer.topo.json\")\nmb_style <- \"jrfep/ckspr4rl70jch17pg3rnix3fz\"\nmb_style <- \"jrfep/cktdnw0d81ioc17nqtvwgs13c\"\nmb_token <- Sys.getenv(\"MAPBOX_TOKEN\")\nmb_url <- \"https://api.mapbox.com/styles/v1/%s/tiles/{z}/{x}/{y}?access_token=%s\"\n\nmb_style <- \"mapbox/satellite-v9\"\n\nmy_url <- sprintf(mb_url, mb_style, mb_token)\n\nmy_attribution <- \"© <a href='https://www.mapbox.com/map-feedback/'>Mapbox</a> CC-BY-4.0 <a href='https://global-ecosystems.org/explore/groups/MFT1.2'>IUCN Global Ecosystem Typology</a>\"\n\nocc <- factor(c(\"major\",\"minor\"))\n\nDPcolors <- c(rgb(193,15,2,255,max=255), rgb(247,157,150,255,max=255))\n\n##st_labels <- sprintf(\"<strong>%s</strong><br/>%s<br/>Category: <strong>%s</strong>\",\n##                        asm_xy$eco_name_orig, asm_xy$ref_code, asm_xy$overall_risk_category ) %>%\n##      lapply(htmltools::HTML)\n##    st_icons <- icons(\n##      iconUrl = sprintf(\"assets/icons/%s.png\",tolower(asm_xy$overall_risk_category)),\n##      iconWidth = 20, iconHeight = 20\n##    )\n\nleaflet() |> \n    setView(lng = 0, lat = 0, zoom = 2) |>\n    addTiles(\n        urlTemplate = my_url,\n        attribution = my_attribution) |>\n  #addPolygons(data = bf, color = 'yellow', fill=FALSE, weight = 2, fillOpacity = 0.15, group='Outline') %>%\n  #addMarkers(data = asm_xy,icon = st_icons,\n  #                 label=st_labels,\n                   # clusterOptions = st_cluster,\n  #                 group=\"RLE assessments\") %>%\n  addLayersControl(\n          overlayGroups = c(\"Outline\",\"RLE assessments\"),\n          options = layersControlOptions(collapsed = FALSE),\n          position = \"topright\"\n        ) |>\n  addLegend(colors = DPcolors, labels = c(\"major\",\"minor\"), opacity = 1.0,\n            title = \"Occurrence\", position = \"topright\")\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"leaflet html-widget html-fill-item\" id=\"htmlwidget-01246b95338b086fdae6\" style=\"width:100%;height:650px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-01246b95338b086fdae6\">{\"x\":{\"options\":{\"crs\":{\"crsClass\":\"L.CRS.EPSG3857\",\"code\":null,\"proj4def\":null,\"projectedBounds\":null,\"options\":{}}},\"setView\":[[0,0],2,[]],\"calls\":[{\"method\":\"addTiles\",\"args\":[\"https://api.mapbox.com/styles/v1/mapbox/satellite-v9/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoianJmZXAiLCJhIjoiY2s5N3RxZWhwMTl5NjNnbjFmdzhubTFjdiJ9.KFBzgxBPjKnERRfR9awR_g\",null,null,{\"minZoom\":0,\"maxZoom\":18,\"tileSize\":256,\"subdomains\":\"abc\",\"errorTileUrl\":\"\",\"tms\":false,\"noWrap\":false,\"zoomOffset\":0,\"zoomReverse\":false,\"opacity\":1,\"zIndex\":1,\"detectRetina\":false,\"attribution\":\"© <a href='https://www.mapbox.com/map-feedback/'>Mapbox<\\/a> CC-BY-4.0 <a href='https://global-ecosystems.org/explore/groups/MFT1.2'>IUCN Global Ecosystem Typology<\\/a>\"}]},{\"method\":\"addLayersControl\",\"args\":[[],[\"Outline\",\"RLE assessments\"],{\"collapsed\":false,\"autoZIndex\":true,\"position\":\"topright\"}]},{\"method\":\"addLegend\",\"args\":[{\"colors\":[\"#C10F02FF\",\"#F79D96FF\"],\"labels\":[\"major\",\"minor\"],\"na_color\":null,\"na_label\":\"NA\",\"opacity\":1,\"position\":\"topright\",\"type\":\"unknown\",\"title\":\"Occurrence\",\"extra\":null,\"layerId\":null,\"className\":\"info legend\",\"group\":null}]}]},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\nUsing the Mapbox raster tile api: https://docs.mapbox.com/api/maps/raster-tiles/\nConvert coordinates to Slippy map tilenames: https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames\nUse image magick to download image and display:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(magick)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLinking to ImageMagick 6.9.12.93\nEnabled features: cairo, fontconfig, freetype, heic, lcms, pango, raw, rsvg, webp\nDisabled features: fftw, ghostscript, x11\n```\n\n\n:::\n\n```{.r .cell-code}\n# https://api.mapbox.com/v4/{tileset_id}/{zoom}/{x}/{y}{@2x}.{format}\nlatlong_mb <- function(lat_deg, lon_deg, zoom, tileset_id, format=\"@2x.jpg\", token=mb_token){\n  lat_rad <- lat_deg * pi /180\n  n <- 2.0 ^ zoom\n  xtile <- floor((lon_deg + 180.0) / 360.0 * n)\n  ytile = floor((1.0 - log(tan(lat_rad) + (1 / cos(lat_rad))) / pi) / 2.0 * n)\n  return( sprintf(\"https://api.mapbox.com/v4/%s/%s/%s/%s.%s?access_token=%s\",\n    tileset_id, zoom, xtile, ytile, format, token))\n\n}\n#jrfep.T1_1_web_mix\n## pico humboldt 8.549661, -70.996142\n## Punc ak Jaya-4.078889, 137.158333\nurl <- latlong_mb(-4.078889, 137.158333, 15, tileset_id = \"mapbox.satellite\")\nraw_img <- image_read(url)\nimage_ggplot(raw_img)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/leaflet-1.3.1/leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-1.3.1/leaflet.js\"></script>\n<link href=\"../../site_libs/leafletfix-1.0.0/leafletfix.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/proj4-2.6.2/proj4.min.js\"></script>\n<script src=\"../../site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js\"></script>\n<link href=\"../../site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/leaflet-binding-2.2.1/leaflet.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}